========
$orderby
========

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol

.. operator:: $orderby

   .. include:: /includes/extracts/mongo-shell-deprecated-meta-operator-orderby.rst

   The :operator:`$orderby` operator sorts the results of a query in
   ascending or descending order.

   The :binary:`~bin.mongo` shell provides the :method:`cursor.sort()`
   method:

   .. code-block:: javascript

      db.collection.find().sort( { age: -1 } )

   You can also specify the option in either of the following forms:

   .. code-block:: javascript

      db.collection.find()._addSpecial( "$orderby", { age : -1 } )
      db.collection.find( { $query: {}, $orderby: { age : -1 } } )

   These examples return all documents in the collection named
   ``collection`` sorted by the ``age`` field in descending order.
   Specify a value to :operator:`$orderby` of negative one (e.g.
   ``-1``, as above) to sort in descending order or a positive value
   (e.g. ``1``) to sort in ascending order.

Behavior
--------

The sort function can use indexes to implicitly obtain the sort order
For sort operations where MongoDB cannot scan an index to obtain the
sort order, MongoDb instead performs an explicit sort on the data set
subject to a 100 megabyte limit of data to sort. If the sort operation
requires more than 100 megabytes of data, MongoDB will return an error
*unless* the operation specifies :method:`cursor.allowDiskUse()` (*New
in MongoDB 4.4*).

.. versionchanged:: 4.4

   Prior to MongoDB 4.4, the limit for sort operations without an
   index was 32 megabytes. See
   :ref:`4.4-rel-notes-sort-memory-limit`.

To avoid this error, create an index to support the sort operation or
use :operator:`$orderby` in conjunction with :method:`cursor.maxTimeMS()`
and/or :method:`cursor.limit()`. The :method:`cursor.limit()` increases
the speed and reduces the amount of memory required to return this
query by way of an optimized algorithm. The specified limit must result
in a number of documents that fall within the 100 megabyte limit.
