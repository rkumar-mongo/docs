========================================================
Release Notes for MongoDB 4.4 (Development Series 4.3.x)
========================================================

.. default-domain:: mongodb

.. contents:: On this page
   :local:
   :backlinks: none
   :depth: 1
   :class: singlecol


.. include:: /includes/in-dev.rst


.. _4.4-rel-notes-agg:

New Aggregation Operators
-------------------------

.. list-table::
   :header-rows: 1
   :widths: 20 80
   
   * - Operator
     - Description

   * - :expression:`$binarySize`
    
     - Returns the size of a given string or binary data value's
       content in bytes.
     
   * - :expression:`$first`

     - Returns the first element in an array.

   * - :expression:`$last`

     - Returns the last element in an array.

   * - :expression:`$isNumber`

     - Returns boolean ``true`` if the specified expression resolves
       to an :bsontype:`integer <Int32>`, :bsontype:`decimal
       <Decimal128>`, :bsontype:`double <Double>`, or :bsontype:`long
       <Int64>`.  
       
       Returns boolean ``false`` if the expression resolves to any other
       :doc:`BSON type </reference/mongodb-extended-json>`, ``null``, or
       a missing field

Deprecated Operators
---------------------

.. include:: /includes/extracts/4.4-currentDate-deprecation.rst

See :ref:`currentDate-example-agg` for an example.

General Improvements
--------------------

.. _4.4-rel-notes-sort-memory-limit:

Explicit Sort Limit Increased
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

For :method:`~cursor.sort()` operations where MongoDB cannot scan an
index to obtain the sort order, MongoDB instead performs an explicit
sort operation on the data. Starting in MongoDB 4.4, explicit sort
operations have a 100 megabyte limit on the amount of data to sort.
MongoDB 4.2 and earlier had a 32 megabyte limit on the amount of data to
sort.

Explicit sort operations which exceed the 100 megabyte limit return
an error *unless* the operation includes the 
:method:`cursor.allowDiskUse()` (*New in MongoDB 4.4*).

For more information on sorting and index use, see
:ref:`sort-index-use`.

.. seealso:: 

   | :method:`cursor.allowDiskUse()`
   | :limit:`Memory Limits on Sort Operations <Sort Operations>`

``allowDiskUse()`` Support for Queries with Large In-Memory Sorts
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

.. versionadded:: 4.4

:method:`cursor.allowDiskUse()` enables use of temporary files on disk
for any data exceeding the 100 megabyte limit on explicit
:method:`cursor.sort` operations (i.e. sort operations which cannot be
resolved using an index). For explicit sort operations which require
more than 100 megabytes of data, MongoDB returns an error *unless* the
query specifies :method:`cursor.allowDiskUse()`.

:method:`cursor.allowDiskUse()` has no effect on sort operations
resolved using an index *or* explicit sort operations on less than 
100 megabytes of data.

If using the :dbcommand:`find` database command, specify the optional
parameter ``allowDiskUse: true`` to allow disk use for explicit sorting
operations.

For instructions on enabling :method:`~cursor.allowDiskUse` for queries
issued through a MongoDB driver, defer to the documentation for your
preferred :ecosystem:`MongoDB 4.4-compatible driver </drivers>`. 

.. seealso:: 

   | :limit:`Memory Limits On Sort Operations <Sort Operations>`
   | :ref:`sort-index-use`

Changes Affecting Compatibility
-------------------------------

Some changes can affect compatibility and may require user actions. For
a detailed list of compatibility changes, see
:doc:`/release-notes/4.4-compatibility`.

Report an Issue
---------------

To report an issue, see
https://github.com/mongodb/mongo/wiki/Submit-Bug-Reports for
instructions on how to file a JIRA ticket for the MongoDB server or one
of the related projects.

.. class:: hidden

   .. toctree::

      /release-notes/4.4-compatibility
